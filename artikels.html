<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		
        <link rel="stylesheet" href="css/themes/Artikelenbeheersysteem.min.css" />
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile.structure-1.3.2.min.css" /> 
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>Artikelenbeheersysteem</title>
		
		<script type="text/javascript" src="phonegap.js"></script>
        <script type="text/javascript" src="barcodescanner.js"></script>
		<script type="text/javascript" src="lib/handlebars.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
        <script type="text/javascript" src="js/json2.js"></script>
        <script type="text/javascript">
            jQuery.support.cors = true; // force cross-site scripting
        </script>
        <script type="text/javascript" src="js/index.js"></script>
    </head>
    <body> 
	
		<div data-role="page" id="productgroep1" data-add-back-btn="false">
			<div data-role="header" data-position="fixed">
				<h1>Artikelenbeheersysteem</h1>
			</div>
			<div data-role="navbar">
				<ul>
					<li><a href="index.html" data-icon="home" data-iconpos="top">Start</a></li>
                    <li><a href="artikels.html" data-icon="grid" data-iconpos="top" class="ui-btn-active">Artikels</a></li>
					<li><a href="zoeken.html" data-icon="search" data-iconpos="top">Zoek artikel</a></li>
                    <li><a href="scannen.html" data-icon="search" data-iconpos="top">Scannen</a></li>
				</ul>
			</div><!-- /navbar -->
			<div data-role="content">
				<ul data-role="listview" data-inset="true" data-filter="true" id="productgroep_1">                
				</ul>
			</div>
			<div data-role="footer" data-id="foo1" data-position="fixed">				
			</div><!-- /footer -->
		</div>

        <div data-role="page" id="productgroep2" data-add-back-btn="true">
			<div data-role="header" data-position="fixed">
				<h1>Artikelenbeheersysteem</h1>
			</div>
			<div data-role="navbar">
				<ul>
					<li><a href="index.html" data-icon="home" data-iconpos="top">Start</a></li>
                    <li><a href="artikels.html" data-icon="grid" data-iconpos="top" class="ui-btn-active">Artikels</a></li>
					<li><a href="zoeken.html" data-icon="search" data-iconpos="top">Zoek artikel</a></li>
                    <li><a href="scannen.html" data-icon="search" data-iconpos="top">Scannen</a></li>
				</ul>
			</div><!-- /navbar -->
			<div data-role="content">
				<ul data-role="listview" data-inset="true" data-filter="true" id="productgroep_2">                
				</ul>
			</div>
			<div data-role="footer" data-id="foo1" data-position="fixed">				
			</div><!-- /footer -->
		</div>
		
        <div data-role="page" id="productgroep3" data-add-back-btn="true">
			<div data-role="header" data-position="fixed">
				<h1>Artikelenbeheersysteem</h1>
			</div>
			<div data-role="navbar">
				<ul>
					<li><a href="index.html" data-icon="home" data-iconpos="top">Start</a></li>
                    <li><a href="artikels.html" data-icon="grid" data-iconpos="top" class="ui-btn-active">Artikels</a></li>
					<li><a href="zoeken.html" data-icon="search" data-iconpos="top">Zoek artikel</a></li>
                    <li><a href="scannen.html" data-icon="search" data-iconpos="top">Scannen</a></li>
				</ul>
			</div><!-- /navbar -->
			<div data-role="content">
				<ul data-role="listview" data-inset="true" data-filter="true" id="productgroep_3">                
				</ul>
			</div>
			<div data-role="footer" data-id="foo1" data-position="fixed">				
			</div><!-- /footer -->
        </div>

        <div data-role="page" id="artikels" data-add-back-btn="true">
			<div data-role="header" data-position="fixed">
				<h1>Artikelenbeheersysteem</h1>
			</div>
			<div data-role="navbar">
				<ul>
					<li><a href="index.html" data-icon="home" data-iconpos="top">Start</a></li>
                    <li><a href="artikels.html" data-icon="grid" data-iconpos="top" class="ui-btn-active">Artikels</a></li>
					<li><a href="zoeken.html" data-icon="search" data-iconpos="top">Zoek artikel</a></li>
                    <li><a href="scannen.html" data-icon="search" data-iconpos="top">Scannen</a></li>
				</ul>
			</div><!-- /navbar -->
			<div data-role="content">
				<ul data-role="listview" data-inset="true" data-filter="true" id="lvwArtikels">                
				</ul>
			</div>
			<div data-role="footer" data-id="foo1" data-position="fixed">				
			</div><!-- /footer -->
        </div>

        <div data-role="page" id="details" data-add-back-btn="true">
			<div data-role="header" data-position="fixed">
				<h1>Artikelenbeheersysteem</h1>
			</div>
			<div data-role="navbar">
				<ul>
					<li><a href="index.html" data-icon="home" data-iconpos="top">Start</a></li>
                    <li><a href="artikels.html" data-icon="grid" data-iconpos="top" class="ui-btn-active">Artikels</a></li>
					<li><a href="zoeken.html" data-icon="search" data-iconpos="top">Zoek artikel</a></li>
                    <li><a href="scannen.html" data-icon="search" data-iconpos="top">Scannen</a></li>
				</ul>
			</div><!-- /navbar -->
			<div data-role="content">
                <div class="artikeldetail_container">
                    <div id="artikelTitel" style="margin: 5;"></div>
                    <div class="container_img" style="margin: 5; text-align: center;">
                        <img id="artikelAfbeelding" />
                    </div>
				    <div id="artikelBeschrijving"></div>
                </div>
			</div>
            <div data-role="footer" data-id="foo1" data-position="fixed"></div><!-- /footer -->
		</div>
		
        <script type="text/javascript">
            //$(document).ready(function () {
            $(document).on('pagebeforeshow', '#productgroep1', function () {
                alert('Pagebeforeshow');
                //loadMainProductgroepen();
                //var serviceUrl = "http://localhost:2914/Services/ArtikelWebService.svc/";
                $.ajax({
                    type: "GET",
                    url: serviceUrl + "GetHoofdproductGroepen",
                    data: "{}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (msg) {

                        for (i = 0; i <= msg.d.length - 1; i++) {
                            var li = $("<li></li>");
                            var uniqueId = $('<input>').attr({
                                type: 'hidden',
                                value: msg.d[i].ID
                            });

                            $(li).tap(function () {
                                var hiddenElement = $(this).find("input");
                                loadSubProductgroepen($(hiddenElement).val());
                            });

                            var a = $("<a></a>").attr("href", "#productgroep2")
						    .attr("data-transition", "slide").text(msg.d[i].GroepsNaam);
                            $(li).append(uniqueId);
                            $(li).append(a);
                            $("#productgroep_1").append(li);
                        }
                        $("#productgroep_1").listview("refresh");
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.status + ' ' + xhr.response + ' ' + xhr.responseText + ' ' + thrownError);
                    }
                });
            });

            function loadSubProductgroepen(hoofdproductgroepID) {
                var param = JSON.stringify({ hoofdproductgroep: hoofdproductgroepID });

                $.mobile.showPageLoadingMsg();

                $("#productgroep_2").children().remove();

                $.ajax({
                    type: "POST",
                    url: serviceUrl + "GetSubProductGroepen",
                    data: param,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (msg) {

                        for (i = 0; i <= msg.d.length - 1; i++) {
                            var li = $("<li></li>");
                            var uniqueId = $('<input>').attr({
                                type: 'hidden',
                                value: msg.d[i].ID
                            });

                            $(li).tap(function () {
                                var hiddenElement = $(this).find("input");
                                loadDetailProductgroepen($(hiddenElement).val());
                            });

                            var a = $("<a></a>").attr("href", "#productgroep3")
						    .attr("data-transition", "slide").text(msg.d[i].GroepsNaam);
                            $(li).append(uniqueId);
                            $(li).append(a);
                            $("#productgroep_2").append(li);
                        }
                        $("#productgroep_2").listview("refresh");

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.status + ' ' + xhr.response + ' ' + xhr.responseText + ' ' + thrownError);
                    }
                });
            }

            function loadDetailProductgroepen(subproductgroepID) {
                var param = JSON.stringify({ subproductgroep: subproductgroepID });

                $.mobile.showPageLoadingMsg();

                $("#productgroep_3").children().remove();

                $.ajax({
                    type: "POST",
                    url: serviceUrl + "GetDetailProductGroepen",
                    data: param,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (msg) {

                        for (i = 0; i <= msg.d.length - 1; i++) {
                            var li = $("<li></li>");
                            var uniqueId = $('<input>').attr({
                                type: 'hidden',
                                value: msg.d[i].ID
                            });

                            $(li).tap(function () {
                                var hiddenElement = $(this).find("input");
                                loadArtikelsByGroep($(hiddenElement).val());
                            });

                            var a = $("<a></a>").attr("href", "#artikels")
						    .attr("data-transition", "slide").text(msg.d[i].GroepsNaam);
                            $(li).append(uniqueId);
                            $(li).append(a);
                            $("#productgroep_3").append(li);
                        }
                        $("#productgroep_3").listview("refresh");

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.status + ' ' + xhr.response + ' ' + xhr.responseText + ' ' + thrownError);
                    }
                });
            }

            function loadArtikelsByGroep(detailproductgroepID) {
                var param = JSON.stringify({ detailproductgroep: detailproductgroepID });

                $.mobile.showPageLoadingMsg();

                $("#lvwArtikels").children().remove();

                $.ajax({
                    type: "POST",
                    url: serviceUrl + "GetArtikelsByProductgroep",
                    data: param,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (msg) {

                        for (i = 0; i <= msg.d.length - 1; i++) {
                            var li = $("<li></li>");
                            var uniqueId = $('<input>').attr({
                                type: 'hidden',
                                value: msg.d[i].ID
                            });

                            $(li).tap(function () {
                                var hiddenElement = $(this).find("input");
                                loadArtikelDetails($(hiddenElement).val());
                            });

                            var a = $("<a></a>").attr("href", "#details")
						    .attr("data-transition", "slide").text(msg.d[i].Titel);
                            $(li).append(uniqueId);
                            $(li).append(a);
                            $("#lvwArtikels").append(li);
                        }
                        $("#lvwArtikels").listview("refresh");

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.status + ' ' + xhr.response + ' ' + xhr.responseText + ' ' + thrownError);
                    }
                });
            }

            function loadArtikelDetails(artikelID) {
                var param = JSON.stringify({ artikel_id: artikelID });
                var params = new Object();
                params.artikelID = artikelID;
                $.ajax({
                    type: "POST",
                    url: serviceUrl + "GetArtikelByID",
                    data: param,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (msg) {
                        loadAtikelDetail(msg.d);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.status + ' ' + xhr.response + ' ' + xhr.responseText + ' ' + thrownError);
                    }
                });
            }

            function loadAtikelDetail(data) {
                $("#artikelTitel").html('<span style="font-weight: bold;">' + data.Titel + '</span>').css('text-align', 'center');
                $("#artikelBeschrijving").html('<p>' + data.Beschrijving + '</p>').css('text-align', 'center');
                //$("#artikelAfbeelding").attr("src", "data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");
                $("#artikelAfbeelding").attr("src", "data:image/jpg;base64," + data.Afbeelding);

                var $img = $('container_img img');
                var h = $img.height();
                $img.css('margin-top', +h / -2 + "px"); //margin-top should be negative half of image height. This will center the image vertically when combined with position:absolute and top:50%.
            }
        </script>
    </body>
</html>