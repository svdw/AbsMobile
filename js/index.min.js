var serviceUrl = "http://magazijn.vtir.be/Services/ArtikelWebService.svc/"; $(document).on("pagebeforeshow", "#productgroep1", function () { $.mobile.showPageLoadingMsg(); var a = $("#productgroep_1"); a.children().remove(); $.ajax({ type: "GET", url: serviceUrl + "GetHoofdproductGroepen", data: "{}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (d) { for (i = 0; i <= d.d.length - 1; i++) { var b = $("<li></li>"), c = $("<a></a>").attr("href", "#productgroep2").attr("data-transition", "slide").text(d.d[i].GroepsNaam), e = $("<input>").attr({ type: "hidden", value: d.d[i].ID }); $(b).tap(function () { var f = $(this).find("input"); loadSubProductgroepen($(f).val()) }); $(b).append(e); $(b).append(c); a.append(b) } a.listview("refresh"); return false }, error: function (d, b, c) { alert(d.status + " " + d.response + " " + d.responseText + " " + c) } }) }); function loadSubProductgroepen(b) { var c = JSON.stringify({ hoofdproductgroep: b }); $.mobile.showPageLoadingMsg(); var a = $("#productgroep_2"); a.children().remove(); $.ajax({ type: "POST", url: serviceUrl + "GetSubProductGroepen", data: c, contentType: "application/json; charset=utf-8", dataType: "json", success: function (f) { for (i = 0; i <= f.d.length - 1; i++) { var d = $("<li></li>"), e = $("<a></a>").attr("href", "#productgroep3").attr("data-transition", "slide").text(f.d[i].GroepsNaam), g = $("<input>").attr({ type: "hidden", value: f.d[i].ID }); $(d).tap(function () { var h = $(this).find("input"); loadDetailProductgroepen($(h).val()) }); $(d).append(g); $(d).append(e); a.append(d) } a.listview("refresh"); return false }, error: function (f, d, e) { alert(f.status + " " + f.response + " " + f.responseText + " " + e) } }) } function loadDetailProductgroepen(c) { var b = JSON.stringify({ subproductgroep: c }); $.mobile.showPageLoadingMsg(); var a = $("#productgroep_3"); a.children().remove(); $.ajax({ type: "POST", url: serviceUrl + "GetDetailProductGroepen", data: b, contentType: "application/json; charset=utf-8", dataType: "json", success: function (f) { for (i = 0; i <= f.d.length - 1; i++) { var d = $("<li></li>"), e = $("<a></a>").attr("href", "#artikels").attr("data-transition", "slide").text(f.d[i].GroepsNaam), g = $("<input>").attr({ type: "hidden", value: f.d[i].ID }); $(d).tap(function () { var h = $(this).find("input"); loadArtikelsByGroep($(h).val()) }); $(d).append(g); $(d).append(e); a.append(d) } a.listview("refresh"); return false }, error: function (f, d, e) { alert(f.status + " " + f.response + " " + f.responseText + " " + e) } }) } function loadArtikelsByGroep(a) { var c = JSON.stringify({ detailproductgroep: a }); $.mobile.showPageLoadingMsg(); var b = $("#lvwArtikels"); b.children().remove(); $.ajax({ type: "POST", url: serviceUrl + "GetArtikelsByProductgroep", data: c, contentType: "application/json; charset=utf-8", dataType: "json", success: function (j) { for (i = 0; i <= j.d.length - 1; i++) { var d = $("<li></li>"), f = $("<img />").attr("src", "data:image/jpg;base64," + j.d[i].Afbeelding), e = $("<a></a>").attr("href", "#details").attr("data-transition", "slide"), g = $("<h2>" + j.d[i].Titel + "</h2>"), h = $("<p>Artikelnummer: " + j.d[i].ArtikelNr + "</p>"), k = $("<input>").attr({ type: "hidden", value: j.d[i].ID }); $(d).tap(function () { var l = $(this).find("input"); loadArtikelDetails($(l).val()) }); e.append(f); e.append(g); e.append(h); $(d).append(k); $(d).append(e); b.append(d) } b.listview("refresh"); return false }, error: function (f, d, e) { alert(f.status + " " + f.response + " " + f.responseText + " " + e) } }) } function loadArtikelDetails(a) { var b = JSON.stringify({ artikel_id: a }); $.ajax({ type: "POST", url: serviceUrl + "GetArtikelByID", data: b, contentType: "application/json; charset=utf-8", dataType: "json", success: function (c) { loadAtikelDetail(c.d) }, error: function (e, c, d) { alert(e.status + " " + e.response + " " + e.responseText + " " + d) } }) } function loadAtikelDetail(a) { $("#artikelTitel").html('<span style="font-weight: bold;">' + a.Titel + "</span>"); $("#artikelBeschrijving").html("<p>" + a.Beschrijving + "</p>"); $("#artikelAfbeelding").attr("src", "data:image/jpg;base64," + a.Afbeelding); $("#lblArtikelEenheid").html(a.Eenheid); $("#lblArtikelStock").html(a.Stock); $("#lblArtikelPrijs").html(a.Catalogusprijs); $("#lblArtikelLeverancier").html(a.Leverancier); return false } function loadAtikelDetailAfterBarcodeScan(a) { $("#artikel_titel").css("text-align", "center").append("<h2>" + a.Titel + "<h2>"); $("#artikel_beschrijving").html("<p>" + a.Beschrijving + "</p>").css("text-align", "center"); $("#artikel_afbeelding").attr("src", "data:image/jpg;base64," + a.Afbeelding); $("#lblEenheid").html(a.Eenheid); $("#lblStock").html(a.Stock); $("#lblPrijs").html(a.Catalogusprijs); $("#lblLeverancier").html(a.Leverancier); return false } $(document).on("pagebeforeshow", "#scannen", function () { window.isphone = false; if (document.URL.indexOf("http://") === -1 && document.URL.indexOf("https://") === -1) { window.isphone = true } if (window.isphone) { document.addEventListener("deviceready", onDeviceReady, false) } else { browserReady() } }); function onDeviceReady() { $("#txtBarcode").tap(function () { var a = cordova.require("cordova/plugin/BarcodeScanner"); a.scan(function (b) { getArtikelByBarcode(b.text); return false }, function (b) { alert("Scanning failed: " + b); return false }) }) } function browserReady() { $("#txtBarcode").keydown(function (a) { if (a.keyCode == 13) { getArtikelByBarcode($("#txtBarcode").val()) } }) } function getArtikelByBarcode(a) { var b = JSON.stringify({ barcode: a }); $.ajax({ type: "POST", url: serviceUrl + "GetArtikelByBarcode", data: b, contentType: "application/json; charset=utf-8", dataType: "json", success: function (c) { loadAtikelDetailAfterBarcodeScan(c.d) }, error: function (e, c, d) { alert(e.status + " " + e.response + " " + e.responseText + " " + d) } }) };