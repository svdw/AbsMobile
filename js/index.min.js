var serviceUrl = "http://magazijn.vtir.be/Services/ArtikelWebService.svc/"; $(document).on("pagebeforeshow", "#productgroep1", function () { var a = $("#productgroep_1"); a.children().remove(); $.ajax({ type: "GET", url: serviceUrl + "GetHoofdproductGroepen", data: "{}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (d) { for (i = 0; i <= d.d.length - 1; i++) { var b = $("<li></li>"), c = $("<a></a>").attr("href", "#productgroep2").attr("data-transition", "slide").text(d.d[i].GroepsNaam), e = $("<input>").attr({ type: "hidden", value: d.d[i].ID }); $(b).tap(function () { var f = $(this).find("input"); loadSubProductgroepen($(f).val()) }); $(b).append(e); $(b).append(c); a.append(b) } a.listview("refresh"); return false }, error: function (d, b, c) { alert(d.status + " " + d.response + " " + d.responseText + " " + c) } }) }); function loadSubProductgroepen(b) { var c = JSON.stringify({ hoofdproductgroep: b }); $.mobile.showPageLoadingMsg(); var a = $("#productgroep_2"); a.children().remove(); $.ajax({ type: "POST", url: serviceUrl + "GetSubProductGroepen", data: c, contentType: "application/json; charset=utf-8", dataType: "json", success: function (f) { for (i = 0; i <= f.d.length - 1; i++) { var d = $("<li></li>"), e = $("<a></a>").attr("href", "#productgroep3").attr("data-transition", "slide").text(f.d[i].GroepsNaam), g = $("<input>").attr({ type: "hidden", value: f.d[i].ID }); $(d).tap(function () { var h = $(this).find("input"); loadDetailProductgroepen($(h).val()) }); $(d).append(g); $(d).append(e); a.append(d) } a.listview("refresh"); return false }, error: function (f, d, e) { alert(f.status + " " + f.response + " " + f.responseText + " " + e) } }) } function loadDetailProductgroepen(c) { var b = JSON.stringify({ subproductgroep: c }); $.mobile.showPageLoadingMsg(); var a = $("#productgroep_3"); a.children().remove(); $.ajax({ type: "POST", url: serviceUrl + "GetDetailProductGroepen", data: b, contentType: "application/json; charset=utf-8", dataType: "json", success: function (f) { for (i = 0; i <= f.d.length - 1; i++) { var d = $("<li></li>"), e = $("<a></a>").attr("href", "#artikels").attr("data-transition", "slide").text(f.d[i].GroepsNaam), g = $("<input>").attr({ type: "hidden", value: f.d[i].ID }); $(d).tap(function () { var h = $(this).find("input"); loadArtikelsByGroep($(h).val()) }); $(d).append(g); $(d).append(e); a.append(d) } a.listview("refresh"); return false }, error: function (f, d, e) { alert(f.status + " " + f.response + " " + f.responseText + " " + e) } }) } function loadArtikelsByGroep(a) { var c = JSON.stringify({ detailproductgroep: a }); $.mobile.showPageLoadingMsg(); var b = $("#lvwArtikels"); b.children().remove(); $.ajax({ type: "POST", url: serviceUrl + "GetArtikelsByProductgroep", data: c, contentType: "application/json; charset=utf-8", dataType: "json", success: function (f) { for (i = 0; i <= f.d.length - 1; i++) { var d = $("<li></li>"), e = $("<a></a>").attr("href", "#details").attr("data-transition", "slide").text(f.d[i].Titel), g = $("<input>").attr({ type: "hidden", value: f.d[i].ID }); $(d).tap(function () { var h = $(this).find("input"); loadArtikelDetails($(h).val()) }); $(d).append(g); $(d).append(e); b.append(d) } b.listview("refresh"); return false }, error: function (f, d, e) { alert(f.status + " " + f.response + " " + f.responseText + " " + e) } }) } function loadArtikelDetails(a) { var b = JSON.stringify({ artikel_id: a }); $.ajax({ type: "POST", url: serviceUrl + "GetArtikelByID", data: b, contentType: "application/json; charset=utf-8", dataType: "json", success: function (c) { loadAtikelDetail(c.d) }, error: function (e, c, d) { alert(e.status + " " + e.response + " " + e.responseText + " " + d) } }) } function loadAtikelDetail(c) { $("#artikelTitel").html('<span style="font-weight: bold;">' + c.Titel + "</span>").css("text-align", "center"); $("#artikelBeschrijving").html("<p>" + c.Beschrijving + "</p>").css("text-align", "center"); $("#artikelAfbeelding").attr("src", "data:image/jpg;base64," + c.Afbeelding); var a = $("container_img img"), b = a.height(); a.css("margin-top", +b / -2 + "px"); return false } $(document).on("pagebeforeshow", "#zoekartikels", function () { GetAllArtikels() }); function GetAllArtikels() { var a = $("#overzicht"); a.children().remove(); $.ajax({ type: "GET", url: serviceUrl + "GetArtikels", data: "{}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (d) { for (i = 0; i <= d.d.length - 1; i++) { var b = $("<li></li>"), c = $("<a></a>").attr("href", "#details").attr("data-transition", "slide").text(d.d[i].Titel), e = $("<input>").attr({ type: "hidden", value: d.d[i].ID }); $(b).tap(function () { var f = $(this).find("input"); loadArtikelDetail($(f).val()) }); $(b).append(e); $(b).append(c); a.append(b) } a.listview("refresh"); return false }, error: function (d, b, c) { alert(d.status + " " + d.response + " " + d.responseText + " " + c) } }) } $(document).on("pagebeforeshow", "#scannen", function () { window.isphone = false; if (document.URL.indexOf("http://") === -1 && document.URL.indexOf("https://") === -1) { window.isphone = true } if (window.isphone) { document.addEventListener("deviceready", onDeviceReady, false) } else { browserReady() } }); function onDeviceReady() { $("#txtBarcode").tap(function () { var a = cordova.require("cordova/plugin/BarcodeScanner"); a.scan(function (b) { getArtikelByBarcode(b.text); return false }, function (b) { alert("Scanning failed: " + b); return false }) }) } function browserReady() { $("#txtBarcode").keydown(function (a) { if (a.keyCode == 13) { getArtikelByBarcode($("#txtBarcode").val()) } }) } function getArtikelByBarcode(a) { var b = JSON.stringify({ barcode: a }); $.ajax({ type: "POST", url: serviceUrl + "GetArtikelByBarcode", data: b, contentType: "application/json; charset=utf-8", dataType: "json", success: function (c) { loadAtikelDetail(c.d) }, error: function (e, c, d) { alert(e.status + " " + e.response + " " + e.responseText + " " + d) } }) };